<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Administrativo - Divino A√ßa√≠</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:'Segoe UI',Arial;background:#f4f4f4}
header{background:linear-gradient(135deg,#5e1675,#e91e63);color:#fff;padding:15px;text-align:center}
.container{max-width:1200px;margin:auto;padding:15px}
.card{background:#fff;padding:15px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);margin-bottom:15px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
input,select,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:1px solid #ccc}
button{background:#e91e63;color:#fff;border:none;cursor:pointer}
.resumo{text-align:center;font-size:18px;font-weight:bold}
.lista{max-height:350px;overflow:auto}
.venda{border-bottom:1px solid #ddd;padding:6px 0;font-size:14px}
.acoes button{width:auto;margin-left:5px;background:#555}
.rank-item{padding:6px;border-bottom:1px solid #ddd}
</style>
</head>

<body>

<header>
<h1>üìä Painel Administrativo</h1>
<p>Divino A√ßa√≠ VV</p>
</header>

<div class="container">

<!-- REGISTRO -->
<div class="card">
<h3 id="tituloForm">üìù Registrar Venda</h3>
<div class="grid">
<select id="produto"></select>
<select id="tamanho"></select>
<input id="quantidade" type="number" min="1" value="1">
<select id="pagamento">
<option>Pix</option>
<option>Dinheiro</option>
<option>Cart√£o</option>
</select>
</div>
<p><b>Total:</b> R$ <span id="valorFinal">0.00</span></p>
<button onclick="salvarVenda()">Salvar Venda</button>
</div>

<!-- RESUMO -->
<div class="grid">
<div class="card resumo">üí∞ Hoje<br>R$ <span id="totalHoje">0.00</span></div>
<div class="card resumo">üìÜ √öltimos 7 dias<br>R$ <span id="totalSemana">0.00</span></div>
<div class="card resumo">üóìÔ∏è M√™s atual<br>R$ <span id="totalMes">0.00</span></div>
<div class="card resumo">üçß A√ßa√≠s vendidos<br><span id="qtdMes">0</span></div>
</div>

<!-- A√á√ïES -->
<div class="grid">
<div class="card"><button onclick="exportarPDF()">üìÑ Exportar PDF</button></div>
<div class="card"><button onclick="exportarBackup()">‚òÅÔ∏è Backup</button></div>
<div class="card"><input type="file" onchange="importarBackup(event)"></div>
</div>

<!-- GR√ÅFICOS -->
<div class="grid">
<div class="card"><canvas id="graficoPagamento"></canvas></div>
<div class="card"><canvas id="graficoDias"></canvas></div>
</div>

<!-- RANKING -->
<div class="card">
<h3>üèÜ Ranking de Sabores</h3>
<div id="ranking"></div>
</div>

<!-- LISTA -->
<div class="card">
<h3>üìã Hist√≥rico de Vendas</h3>
<div class="lista" id="listaVendas"></div>
</div>

</div>

<script>
/* ================= DADOS ================= */
const produtos={
"Morango Love üçì":{300:15,500:20},
"Tradicional":{300:15,500:20},
"Banana üçå":{300:15,500:20},
"Leite Ninho ü•õ":{300:15,500:20},
"Chocolate üç´":{300:15,500:20},
"Pa√ßoca ü•ú":{300:15,500:20}
};

let vendas = JSON.parse(localStorage.getItem("vendas")) || [];
let editIndex = null;

/* ================= ELEMENTOS ================= */
const produtoSel = document.getElementById("produto");
const tamanhoSel = document.getElementById("tamanho");
const qtdInput = document.getElementById("quantidade");
const pagamentoSel = document.getElementById("pagamento");
const valorFinalEl = document.getElementById("valorFinal");

/* ================= INIT ================= */
produtoSel.innerHTML = "<option value=''>Produto</option>" +
Object.keys(produtos).map(p=>`<option>${p}</option>`).join("");

produtoSel.onchange = ()=>{
    tamanhoSel.innerHTML="<option value=''>Tamanho</option>";
    if(produtoSel.value){
        Object.keys(produtos[produtoSel.value])
        .forEach(t=>tamanhoSel.innerHTML+=`<option value="${t}">${t}ml</option>`);
    }
    calcularTotal();
};

[tamanhoSel, qtdInput].forEach(el=>el.oninput = calcularTotal);

/* ================= FUN√á√ïES ================= */
function calcularTotal(){
    if(produtoSel.value && tamanhoSel.value){
        const preco = produtos[produtoSel.value][tamanhoSel.value];
        const qtd = parseInt(qtdInput.value) || 1;
        valorFinalEl.innerText = (preco * qtd).toFixed(2);
    }else{
        valorFinalEl.innerText = "0.00";
    }
}

function salvarVenda(){
    if(!produtoSel.value || !tamanhoSel.value){
        alert("Selecione produto e tamanho");
        return;
    }

    const venda = {
        produto: produtoSel.value,
        tamanho: tamanhoSel.value,
        quantidade: parseInt(qtdInput.value),
        pagamento: pagamentoSel.value,
        valor: produtos[produtoSel.value][tamanhoSel.value] * parseInt(qtdInput.value),
        data: new Date().toISOString()
    };

    if(editIndex !== null){
        vendas[editIndex] = venda;
        editIndex = null;
        document.getElementById("tituloForm").innerText = "üìù Registrar Venda";
    }else{
        vendas.push(venda);
    }

    limparFormulario();
    persistir();
}

function editarVenda(i){
    const v = vendas[i];
    produtoSel.value = v.produto;
    produtoSel.onchange();
    tamanhoSel.value = v.tamanho;
    qtdInput.value = v.quantidade;
    pagamentoSel.value = v.pagamento;
    valorFinalEl.innerText = v.valor.toFixed(2);
    editIndex = i;
    document.getElementById("tituloForm").innerText = "‚úèÔ∏è Editar Venda";
}

function excluirVenda(i){
    if(confirm("Excluir esta venda?")){
        vendas.splice(i,1);
        persistir();
    }
}

function limparFormulario(){
    produtoSel.value="";
    tamanhoSel.innerHTML="<option value=''>Tamanho</option>";
    qtdInput.value=1;
    valorFinalEl.innerText="0.00";
}

function persistir(){
    localStorage.setItem("vendas", JSON.stringify(vendas));
    atualizarPainel();
}

/* ================= BACKUP ================= */
function exportarBackup(){
    const blob = new Blob([JSON.stringify(vendas)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="backup-vendas-divino-acai.json";
    a.click();
}

function importarBackup(e){
    const reader = new FileReader();
    reader.onload = ()=>{
        try{
            const dados = JSON.parse(reader.result);
            if(Array.isArray(dados)){
                vendas = dados;
                persistir();
            }else alert("Arquivo inv√°lido");
        }catch{
            alert("Erro ao importar backup");
        }
    };
    reader.readAsText(e.target.files[0]);
}

/* ================= PAINEL ================= */
let graficoPagamento, graficoDias;

function atualizarPainel(){
    const hoje = new Date();
    let totalHoje=0, totalSemana=0, totalMes=0, qtdMes=0;
    let pagamentos={Pix:0,Dinheiro:0,Cart√£o:0};
    let porDia={}, ranking={};

    listaVendas.innerHTML="";
    rankingEl.innerHTML="";

    vendas.forEach((v,i)=>{
        const d = new Date(v.data);
        const diffDias = Math.floor((hoje - d) / 86400000);

        if(d.toDateString() === hoje.toDateString()) totalHoje += v.valor;
        if(diffDias <= 6) totalSemana += v.valor;
        if(d.getMonth() === hoje.getMonth() && d.getFullYear() === hoje.getFullYear()){
            totalMes += v.valor;
            qtdMes += v.quantidade;
        }

        pagamentos[v.pagamento] += v.valor;
        porDia[d.getDate()] = (porDia[d.getDate()] || 0) + v.valor;
        ranking[v.produto] = (ranking[v.produto] || 0) + v.quantidade;

        listaVendas.innerHTML += `
        <div class="venda">
        ${d.toLocaleDateString()} ‚Ä¢ ${v.produto} ${v.tamanho}ml x${v.quantidade}
        ‚Ä¢ R$ ${v.valor.toFixed(2)}
        <span class="acoes">
        <button onclick="editarVenda(${i})">‚úèÔ∏è</button>
        <button onclick="excluirVenda(${i})">üóëÔ∏è</button>
        </span>
        </div>`;
    });

    totalHojeEl.innerText = totalHoje.toFixed(2);
    totalSemanaEl.innerText = totalSemana.toFixed(2);
    totalMesEl.innerText = totalMes.toFixed(2);
    qtdMesEl.innerText = qtdMes;

    Object.entries(ranking).sort((a,b)=>b[1]-a[1])
    .forEach(r=>rankingEl.innerHTML+=`<div class="rank-item">${r[0]} ‚Äî ${r[1]}</div>`);

    atualizarGraficos(pagamentos, porDia);
}

/* ================= GR√ÅFICOS ================= */
function atualizarGraficos(p,pd){
    if(graficoPagamento) graficoPagamento.destroy();
    if(graficoDias) graficoDias.destroy();

    graficoPagamento = new Chart(graficoPagamentoEl,{
        type:'pie',
        data:{labels:Object.keys(p),datasets:[{data:Object.values(p)}]}
    });

    graficoDias = new Chart(graficoDiasEl,{
        type:'bar',
        data:{labels:Object.keys(pd),datasets:[{data:Object.values(pd)}]}
    });
}

/* ================= PDF ================= */
function exportarPDF(){
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    let totalGeral = vendas.reduce((s,v)=>s+v.valor,0);
    let y = 15;

    pdf.text("Relat√≥rio de Vendas - Divino A√ßa√≠ VV",10,y); y+=10;
    pdf.text(`Total Geral: R$ ${totalGeral.toFixed(2)}`,10,y); y+=10;

    vendas.forEach(v=>{
        pdf.text(
        `${new Date(v.data).toLocaleDateString()} - ${v.produto} ${v.tamanho}ml x${v.quantidade} - R$ ${v.valor.toFixed(2)}`,
        10,y);
        y+=7;
        if(y>280){pdf.addPage();y=15;}
    });

    pdf.save("relatorio-vendas-divino-acai.pdf");
}

/* ================= VARS ================= */
const totalHojeEl=document.getElementById("totalHoje");
const totalSemanaEl=document.getElementById("totalSemana");
const totalMesEl=document.getElementById("totalMes");
const qtdMesEl=document.getElementById("qtdMes");
const listaVendas=document.getElementById("listaVendas");
const rankingEl=document.getElementById("ranking");
const graficoPagamentoEl=document.getElementById("graficoPagamento");
const graficoDiasEl=document.getElementById("graficoDias");

/* ================= START ================= */
atualizarPainel();
</script>

</body>
  </html>
  
